<!-- Skills Modal -->
<div x-data="{ open: false }" 
     @keydown.escape.window="open = false"
     @open-skills-modal.window="open = true">
    
    <!-- Backdrop -->
    <div x-show="open" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 bg-black/25 backdrop-blur-sm" 
         aria-hidden="true"></div>

    <!-- Modal -->
    <div x-show="open"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
         x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
         x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
         class="fixed inset-0 z-50 overflow-y-auto"
         @click="open = false">
         
        <div class="flex min-h-screen items-center justify-center p-4">
            <div @click.stop
                 x-trap.noscroll.inert="open"
                 class="relative w-screen h-screen sm:w-11/12 sm:h-[85vh] sm:max-w-7xl p-0 m-0 sm:m-auto sm:rounded-2xl bg-base-100 shadow-xl">
        <div class="flex flex-col h-full">
            <!-- Header -->
            <div class="flex-none p-3 sm:p-6 border-b border-base-200 bg-base-100">
                <div class="flex items-center justify-between gap-4 mb-3 sm:mb-4">
                    <h3 class="text-lg sm:text-2xl font-bold">Select Skills</h3>
                </div>
                <!-- Search input -->
                <div class="form-control">
                    <div class="relative">
                        <input type="text" 
                               placeholder="Search" 
                               class="input input-md sm:input-lg input-bordered w-full pl-12" 
                               id="skill-search">
                        <iconify-icon icon="heroicons:magnifying-glass" 
                                     class="absolute left-4 top-1/2 -translate-y-1/2 text-base-content/50"
                                     width="20"></iconify-icon>
                    </div>
                </div>
            </div>

            <!-- Main content area -->
            <div class="flex-1 overflow-y-auto relative pb-20">
                <div class="relative min-h-full overflow-x-hidden">
                    <!-- Quick letters -->
                    <div class="quick-letters-list">
                        {% for letter in "ABCDEFGHIJKLMNOPQRSTUVWXYZ" %}
                        <button class="quick-letter" data-letter="{{ letter }}">{{ letter }}</button>
                        {% endfor %}
                    </div>

                    <!-- Skills groups -->
                    <div class="pr-8">
                        {% for group in skill_icons %}
                            <div class="skill-group" data-letter="{{ group.letter }}">
                                <div class="sticky top-0 z-20 bg-base-100 shadow-sm">
                                    <div class="flex items-center gap-3 p-3 sm:p-4">
                                        <span class="text-2xl sm:text-3xl font-bold text-primary w-10 h-10 flex items-center justify-center">
                                            {{ group.letter }}
                                        </span>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-2 p-2 sm:p-4">
                                    {% for skill in group.skills %}
                                        <label class="group flex items-center gap-2 p-2 sm:p-3 rounded-xl hover:bg-base-200 cursor-pointer transition-all duration-200 hover:shadow-md active:scale-[0.98]">
                                            <input type="checkbox" 
                                                   class="checkbox checkbox-sm sm:checkbox-md checkbox-primary" 
                                                   value="{{ skill.name }}"
                                                   data-skill='{"name": "{{ skill.name }}", "icon": "{{ skill.icon }}", "icon_dark": "{{ skill.icon_dark|default:skill.icon }}"}'>
                                            <div class="flex items-center gap-3 min-w-0 flex-1">
                                                <iconify-icon data-icon="{{ skill.icon }}" 
                                                            data-icon-dark="{{ skill.icon_dark|default:skill.icon }}"
                                                            class="w-8 h-8 sm:w-12 sm:h-12 bg-base-200 rounded-lg group-hover:bg-base-300 transition-colors transform transition-transform duration-200 group-hover:scale-110 flex-shrink-0"
                                                            style="display: inline-block; font-size: 32px;"
                                                            height="none"></iconify-icon>
                                                <span class="text-sm sm:text-base font-medium truncate flex-1">{{ skill.name }}</span>
                                            </div>
                                        </label>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="flex-none border-t border-base-200 bg-base-100">
                <div class="p-3 flex justify-end gap-3">
                    <button type="button" 
                            class="btn btn-sm sm:btn-md btn-ghost" 
                            @click="open = false">
                        <iconify-icon icon="heroicons:x-mark-20-solid" class="text-lg"></iconify-icon>
                        <span>Cancel</span>
                    </button>
                    <button type="button"
                            class="btn btn-sm sm:btn-md btn-primary"
                            @click="window.skillsManager.applySelectedSkills(); open = false"
                            x-ref="confirmButton">
                        <iconify-icon icon="heroicons:check-20-solid" class="text-lg"></iconify-icon>
                        <span>Apply</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('skillsModal', () => ({
            open: false,
            init() {
                this.$watch('open', value => {
                    if (!value) {
                        window.skillsManager?.resetModalState();
                    }
                });
            }
        }));
    });
</script>
